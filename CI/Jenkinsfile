pipeline {
    agent any
    environment {
        registry = "foxyfox/trollquiz"
        registryCredential = 'docker-technical-foxyfox'
        dockerImage = ''
    }
    stages {
        stage('Build') {
              when {
                anyOf {
                  branch 'master'
                  branch 'dev'
                  changeRequest target: 'master'
                  changeRequest target: 'dev'
                }
              }
              steps {
                sh 'chmod +x ./Backend/gradlew'
                sh 'cd ./Backend < ls'
                sh './gradlew bootJar'
                sh 'cd ..'
              }
            }
            stage('Test') {
              when {
                anyOf {
                  branch 'master'
                  branch 'dev'
                  changeRequest target: 'master'
                  changeRequest target: 'dev'
                }
              }
              steps {
                sh 'cd ./Backend'
                sh './gradlew test'
                sh 'cd ../Frontend'
                sh 'npm install'
                sh 'ng test --single-run true'
              }
            }
    }
}
